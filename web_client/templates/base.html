{%- extends 'bootstrap/base.html' -%}

{%- block styles -%}
    {{super()}}
    <!-- Custom -->
    <link href="../static/css/footer.css" rel="stylesheet">
    <link href="../static/css/base.css" rel="stylesheet">
{%- endblock styles -%}

{%- block title -%}
    {%- if title -%}
        {{ title }}
    {%- else -%}
        {{ _("HSE Marsohod CAD") }}
    {%- endif -%}
{%- endblock title -%}

{%- block navbar -%}
<nav class="navbar navbar-default">
    <div class="container">
        {# For brand and colapsed navbar. #}
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">{{ _("Toggle navigation") }}</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                {{ _("HSE Marsohod CAD") }}
            </a>
        </div>
        {# Navbar content #}
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            {#{%- if boards -%} {# render links to all available borders # }
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        {{ _("Configs Generator") }}
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">{{ _("Board type") }}</li>
                        <li role="separator" class="divider"></li>
                        {%- for board in boards -%}
                        <li>
                            <a href="{{ url_for('generate.board', board=board) }}">
                                {{ board }}
                            </a>
                        </li>
                        {%- endfor -%}
                    </ul>
                </li>
            </ul>
            {%- endif -%}#}

            <ul class="nav navbar-nav navbar-right">
                {# Account actions #}
                {%- if current_user.is_anonymous -%}
                <li>
                    <a href="{{ url_for('auth.login') }}">
                        {{ _("Login") }}
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('auth.register') }}">
                        {{ _("Register") }}
                    </a>
                </li>
                {%- else -%}
                {#
                <li>
                    <a href="{{ url_for("files.static") }}">{{ _("Files") }}</a>
                </li>
                <li>
                    <img with="25" height="25" class="img-circle profile-img" alt="Generic placeholder image" src="{{ current_user.avatar_s }}" />
                </li>
                #}
                <li>
                    <a href="{{ url_for('profile.user', username=current_user.username) }}">
                        {{ _("Profile") }}
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('blog.posts') }}">
                        {{ _("Articles") }}
                    </a>
                </li>
                {%- if current_user.can_edit_posts -%}
                <li>
                    <a href="{{ url_for('blog.drafts') }}">
                        {{ _("Drafts") }}
                    </a>
                </li>
                {%- endif -%}
                <li>
                    <a href="{{ url_for('auth.logout') }}">
                        {{ _("Logout") }}
                    </a>
                </li>
                {%- endif -%}
            </ul>
        </div>
    </div>
</nav>
{%- endblock navbar -%}

{%- block content -%}
    {{super()}}
    <div class="container">
    {%- with messages = get_flashed_messages() -%}
        {%- if messages -%}
            {%- for message in messages -%}
            <div class="alert alert-info" role="alert">
                {{ message }}
            </div>
            {%- endfor -%}
        {%- endif -%}
    {%- endwith -%}

    {# application content needs to be provided in the app_content block #}
    {%- block app_content -%}{%- endblock -%}
    </div>
    <br/>

    {%- block footer -%}
    {# Custom footer #}
    <footer class="footer">
        <div class="container">
            <p class="text-muted">
                {{ _("Created by HSE University students") }}
                <a href="mailto:dapchelkin@edu.hse.ru?Subject=FPGAMarsohodCAD%20Question" target="_top">
                    {{ _("Dmitriy Pchelkin") }}
                </a>
                {{ _("and") }}
                <a href="mailto:aaivanov_5@edu.hse.ru?Subject=FPGAMarsohodCAD%20Question" target="_top">
                    {{ _("Alexey Ivanov") }}
                </a>
                |
                <a href="https://github.com/hell03end/FPGAMarsohodCAD/issues/new">
                    {{ _("Report issue") }}
                </a>
                |
                <a href="https://github.com/hell03end/FPGAMarsohodCAD">
                    {{ _("Contribute") }}
                </a> (Fork on GitHub)
            </p>
        </div>
    </footer>
    {%- endblock footer -%}
{%- endblock content -%}

{%- block scripts -%}
    {{ super() }}
    {{ moment.include_moment() }}

    <script>
        $(function () /* startup code */ {
            var timer = null;
            var xhr = null;
            $('.user_popup').hover(
                function (event) {
                    var elem = $(event.currentTarget);
                    timer = setTimeout(function () {
                        timer = null;
                        xhr = $.ajax('/profile/' + elem.first().text().trim() + '/popup').done(function (data) {
                            xhr = null;
                            elem.popover({
                                trigger: 'manual',
                                html: true,
                                animation: false,
                                container: elem,
                                content: data
                            }).popover('show');
                            flask_moment_render_all();
                        });
                    }, 400);
                },
                function (event) {
                    // mouse out event handler
                    var elem = $(event.currentTarget);
                    if (timer) {
                        clearTimeout(timer);
                        timer = null;
                    } else if (xhr) {
                        xhr.abort();
                        xhr = null;
                    } else {
                        elem.popover('destroy');
                    }
                }
            )
        });
</script> {%- endblock -%}
